name: ðŸ”„ Sync Template Updates

on:
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout current repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: ðŸ”— Add template remote
        run: |
          git remote add template https://github.com/Firi0n/MkDocs-setup.git
          git fetch template main

      - name: ðŸŒ¿ Create temporary branch and try merge
        run: |
          git checkout -b sync-temp
          git merge template/main --no-edit || echo "merge_conflicts=true" >> $GITHUB_ENV

      - name: ðŸš€ If merge without conflicts, update main branch
        if: env.merge_conflicts != 'true'
        run: |
          git checkout main
          git merge sync-temp --no-edit
          git push origin main

      - name: ðŸ“¬ Create pull request if merge conflicts
        if: env.merge_conflicts == 'true'
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "Sync template updates with conflicts"
          branch: sync-temp
          title: "Template updates require manual merge"
          body: |
            Automatic merge failed due to conflicts.
            Please resolve the conflicts in this pull request.
